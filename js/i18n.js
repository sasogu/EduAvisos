(function () {
  const DEFAULT_LANGUAGE = "es";
  const SUPPORTED_LANGUAGES = ["es", "ca", "en"];

  const I18N = {
    es: {
      "app.title": "EduAvisos",
      "app.view": "Vista",
      "app.view.toggles": "Mostrar u ocultar columnas",
      "app.students": "Alumnos",
      "app.semaphore": "Sem√°foro",
      "app.mode": "Modo",
      "app.class": "Clase",
      "app.class.select": "Seleccionar clase",
      "app.resetCounters": "Reiniciar contadores",
      "app.timer.play": "Iniciar/Reanudar tiempo",
      "app.timer.play.title": "Iniciar",
      "app.timer.pause": "Pausar tiempo",
      "app.timer.pause.title": "Pausa",
      "app.settings.open": "Abrir configuraci√≥n",
      "app.settings.title": "Configuraci√≥n",
      "config.title": "Configuraci√≥n",
      "action.close": "Cerrar",
      "action.edit": "Editar",
      "action.delete": "Eliminar",
      "config.className.label": "Nombre de clase (para la clase seleccionada)",
      "config.className.placeholder": "Ej: 1¬∫A",
      "config.className.save": "Guardar nombre",
      "config.language.label": "Idioma de la interfaz",
      "config.language.auto": "Autom√°tico (navegador)",
      "config.language.es": "Espa√±ol",
      "config.language.ca": "Catal√†",
      "config.language.en": "English",
      "config.negMinutes": "Minutos por ‚òπÔ∏é",
      "config.posMinutes": "Minutos por üôÇ",
      "config.admin.subtitle": "Administraci√≥n: exporta una copia de seguridad de tus datos (todas las clases) o imp√≥rtala para restaurar.",
      "config.export": "Exportar copia (.json)",
      "config.import.label": "Importar copia (.json)",
      "config.import.button": "Importar copia",
      "config.importStudents.subtitle": "Importa alumnos: pega una lista (1 por l√≠nea) o carga un archivo .txt/.csv. Se A√ëADEN a la clase actual (no se borra lo existente).",
      "config.importPaste.label": "Pegar lista",
      "config.importPaste.placeholder": "Ejemplo:\nAna P√©rez\nJuan L√≥pez\nMar√≠a Garc√≠a",
      "config.importFile.label": "Archivo",
      "config.importPdf.label": "PDF (verReport)",
      "config.import.apply": "Importar en esta clase",
      "config.import.clear": "Limpiar caja",
      "timer.title": "Tiempo pendiente (‚òπÔ∏é)",
      "timer.subtitle": "Alumnos con tiempo pendiente en la clase actual. La cuenta atr√°s se actualiza en vivo mientras el temporizador est√° en Play.",
      "timer.empty": "No hay alumnos con tiempo pendiente en esta clase.",
      "timer.list.aria": "Alumnos con tiempo pendiente",
      "history.title": "Hist√≥rico",
      "history.list.aria": "Hist√≥rico del alumno",
      "history.empty": "Este alumno a√∫n no tiene eventos en el hist√≥rico.",
      "classHistory.title": "Hist√≥rico de la clase",
      "classHistory.subtitle": "Resumen por alumno (totales de ‚òπÔ∏é y üôÇ).",
      "classHistory.list.aria": "Resumen de la clase",
      "classHistory.empty": "Esta clase a√∫n no tiene puntos en el hist√≥rico.",
      "list.title": "Alumnos",
      "list.classHistory": "Hist√≥rico de la clase",
      "list.filter.neg": "‚òπÔ∏é ‚â•",
      "list.filter.pos": "üôÇ ‚â•",
      "list.filter.clear": "Limpiar filtro",
      "list.subtitle": "Click en el nombre: +1 ‚òπÔ∏é. Botones \"+‚òπÔ∏é\" y \"+üôÇ\" para sumar sin pinchar el nombre.",
      "list.aria": "Lista de alumnos",
      "empty.noStudents": "A√∫n no hay alumnos en esta clase. Importa una lista arriba.",
      "sound.title": "Sem√°foro de sonido",
      "sound.toggle.show": "Mostrar configuraci√≥n",
      "sound.toggle.hide": "Ocultar configuraci√≥n",
      "sound.button.enable": "Activar",
      "sound.button.disable": "Desactivar",
      "sound.status.initial": "Pulsa ‚ÄúActivar‚Äù y permite el micr√≥fono.",
      "sound.aria.traffic": "Sem√°foro de sonido",
      "sound.aria.readout": "Lectura del nivel de sonido",
      "sound.unit.level": "nivel",
      "sound.hint.green": "Verde <",
      "sound.hint.red": "¬∑ Rojo ‚â•",
      "sound.calibration.aria": "Calibraci√≥n r√°pida",
      "sound.calibrate.silence": "Calibrar silencio (verde)",
      "sound.calibrate.talk": "Calibrar aula (hablando normal)",
      "sound.gain.aria": "Sensibilidad del micr√≥fono",
      "sound.gain.label": "Sensibilidad (ganancia)",
      "sound.range.aria": "Ajuste manual del rango",
      "sound.range.green": "Verde hasta (nivel 0‚Äì100)",
      "sound.range.red": "Rojo desde (nivel 0‚Äì100)",
      "sound.thresholds.aria": "Umbrales exactos",
      "sound.thresholds.green": "Verde hasta (nivel) ‚Äî exacto",
      "sound.thresholds.red": "Rojo desde (nivel) ‚Äî exacto",
      "sound.capture": "Capturar",
      "sound.colors.aria": "Colores del sem√°foro",
      "sound.color.green": "Color verde",
      "sound.color.amber": "Color √°mbar",
      "sound.color.red": "Color rojo",
      "sound.colors.reset": "Restablecer colores",
      "mode.title": "Modo de trabajo",
      "mode.subtitle": "Marca el objetivo del aula para este momento.",
      "mode.aria.body": "Indicador del modo de trabajo",
      "mode.aria.badge": "Indicador del modo",
      "mode.aria.controls": "Seleccionar modo",
      "mode.label.explain": "Explicaci√≥n",
      "mode.label.work": "Trabajo",
      "mode.label.debate": "Debate",
      "mode.hint.explain": "Objetivo: sem√°foro en VERDE (silencio).",
      "mode.hint.work": "Objetivo: sem√°foro en √ÅMBAR (voz baja).",
      "mode.hint.debate": "Objetivo: sem√°foro en ROJO solo puntualmente (moderaci√≥n).",
      "mode.button.explain": "Explicaci√≥n (verde)",
      "mode.button.work": "Trabajo (√°mbar)",
      "mode.button.debate": "Debate (rojo)",
      "footer.data": "Datos guardados en tu navegador (localStorage).",
      "resizer.lm": "Ajustar ancho entre Alumnos y Sem√°foro",
      "resizer.mr": "Ajustar ancho entre Sem√°foro y Modo",
      "status.showing": "Mostrando {visible}/{total} ({filters})",
      "status.total": "{total} alumnos",
      "empty.filter": "No hay alumnos que cumplan el filtro ({filters}). Baja el filtro o suma avisos.",
      "join.and": "y",
      "aria.addOne": "Sumar +1 a {name}",
      "aria.negCount": "Avisos negativos: {count}",
      "aria.timerRemaining": "Tiempo restante por avisos negativos",
      "aria.posCount": "Avisos positivos: {count}",
      "aria.addNeg": "Sumar aviso negativo a {name}",
      "aria.addPos": "Sumar aviso positivo a {name}",
      "aria.viewHistory": "Ver hist√≥rico de {name}",
      "aria.editName": "Editar nombre: {name}",
      "aria.deleteStudent": "Eliminar alumno: {name}",
      "status.classNameSaved": "Nombre de clase guardado",
      "alert.classNameEmpty": "El nombre de la clase no puede estar vac√≠o.",
      "confirm.resetCounters": "¬øReiniciar contadores de {className}?",
      "prompt.newName": "Nuevo nombre para {name}:",
      "alert.nameEmpty": "El nombre no puede estar vac√≠o.",
      "alert.nameExists": "Ya existe un alumno con ese nombre en esta clase.",
      "status.nameUpdated": "Nombre actualizado",
      "confirm.deleteStudent": "¬øEliminar a {student} de {className}?",
      "status.timerStarted": "Temporizador iniciado",
      "status.timerPaused": "Tiempo en pausa",
      "status.backup.exported": "Copia exportada",
      "status.backup.imported": "Copia importada",
      "status.backup.selectJson": "Selecciona un .json primero",
      "confirm.backup.import": "Esto reemplazar√° TODOS tus datos (todas las clases) por la copia importada. ¬øContinuar?",
      "error.backup.invalidJson": "El archivo no es JSON v√°lido",
      "error.backup.formatUnknown": "Formato de copia no reconocido",
      "status.pdf.reading": "Leyendo PDF‚Ä¶",
      "status.import.noNames": "No se detectaron nombres para importar",
      "status.import.done": "Importados: {added} nuevos ¬∑ {skipped} duplicados ¬∑ {className}",
      "error.import": "Error al importar",
      "error.export": "Error al exportar",
      "error.history": "Error al abrir hist√≥rico",
      "sound.status.enableFirst": "Activa el micr√≥fono primero (bot√≥n Activar).",
      "sound.status.silenceCalibrated": "Silencio calibrado: nivel {level}. Ahora pulsa ‚ÄúCalibrar aula (hablando normal)‚Äù.",
      "sound.status.pressSilence": "Primero pulsa ‚ÄúCalibrar silencio (verde)‚Äù.",
      "sound.status.calibrated": "Calibrado. Verde < {green} ¬∑ Rojo ‚â• {red} (nivel).",
      "sound.error.noMicSupport": "Este navegador no soporta acceso al micr√≥fono.",
      "sound.status.activating": "Activando‚Ä¶",
      "sound.status.active": "Sensor activo. Ajusta el umbral seg√∫n necesites.",
      "sound.error.activate": "No se pudo activar el micr√≥fono",
      "sound.error.activateWithMsg": "No se pudo activar: {msg}",
      "sound.status.disabled": "Sensor desactivado.",
      "sound.level.green": "VERDE: el ruido est√° en el umbral correcto.",
      "sound.level.amber": "√ÅMBAR: el ruido es aceptable, pero cerca del l√≠mite.",
      "sound.level.red": "ROJO: nos hemos pasado con el ruido.",
      "pdf.error.load": "No se pudo cargar pdf.js: {url}",
      "pdf.error.noExpose": "pdf.js carg√≥ pero no expuso pdfjsLib",
      "pdf.error.final": "No se pudo cargar pdf.js. Revisa la conexi√≥n o coloca pdf.min.js y pdf.worker.min.js en /vendor.",
      "file.error.read": "No se pudo leer el archivo",
      "class.default": "Clase {index}"
    },
    ca: {
      "app.title": "EduAvisos",
      "app.view": "Vista",
      "app.view.toggles": "Mostrar o amagar columnes",
      "app.students": "Alumnes",
      "app.semaphore": "Sem√†for",
      "app.mode": "Mode",
      "app.class": "Classe",
      "app.class.select": "Seleccionar classe",
      "app.resetCounters": "Reiniciar comptadors",
      "app.timer.play": "Iniciar/Reprendre temps",
      "app.timer.play.title": "Iniciar",
      "app.timer.pause": "Pausar temps",
      "app.timer.pause.title": "Pausa",
      "app.settings.open": "Obrir configuraci√≥",
      "app.settings.title": "Configuraci√≥",
      "config.title": "Configuraci√≥",
      "action.close": "Tancar",
      "action.edit": "Editar",
      "action.delete": "Eliminar",
      "config.className.label": "Nom de classe (per a la classe seleccionada)",
      "config.className.placeholder": "Ex: 1r A",
      "config.className.save": "Desar nom",
      "config.language.label": "Idioma de la interf√≠cie",
      "config.language.auto": "Autom√†tic (navegador)",
      "config.language.es": "Espanyol",
      "config.language.ca": "Catal√†",
      "config.language.en": "English",
      "config.negMinutes": "Minuts per ‚òπÔ∏é",
      "config.posMinutes": "Minuts per üôÇ",
      "config.admin.subtitle": "Administraci√≥: exporta una c√≤pia de seguretat de les teves dades (totes les classes) o importa-la per restaurar.",
      "config.export": "Exportar c√≤pia (.json)",
      "config.import.label": "Importar c√≤pia (.json)",
      "config.import.button": "Importar c√≤pia",
      "config.importStudents.subtitle": "Importa alumnes: enganxa una llista (1 per l√≠nia) o carrega un arxiu .txt/.csv. S'AFEGEIXEN a la classe actual (no s'esborra el que ja hi ha).",
      "config.importPaste.label": "Enganxar llista",
      "config.importPaste.placeholder": "Exemple:\nAna P√©rez\nJuan L√≥pez\nMar√≠a Garc√≠a",
      "config.importFile.label": "Arxiu",
      "config.importPdf.label": "PDF (verReport)",
      "config.import.apply": "Importar en aquesta classe",
      "config.import.clear": "Netejar caixa",
      "timer.title": "Temps pendent (‚òπÔ∏é)",
      "timer.subtitle": "Alumnes amb temps pendent a la classe actual. El compte enrere s'actualitza en viu mentre el temporitzador est√† en Play.",
      "timer.empty": "No hi ha alumnes amb temps pendent en aquesta classe.",
      "timer.list.aria": "Alumnes amb temps pendent",
      "history.title": "Hist√≤ric",
      "history.list.aria": "Hist√≤ric de l'alumne",
      "history.empty": "Aquest alumne encara no t√© esdeveniments a l'hist√≤ric.",
      "classHistory.title": "Hist√≤ric de la classe",
      "classHistory.subtitle": "Resum per alumne (totals de ‚òπÔ∏é i üôÇ).",
      "classHistory.list.aria": "Resum de la classe",
      "classHistory.empty": "Aquesta classe encara no t√© punts a l'hist√≤ric.",
      "list.title": "Alumnes",
      "list.classHistory": "Hist√≤ric de la classe",
      "list.filter.neg": "‚òπÔ∏é ‚â•",
      "list.filter.pos": "üôÇ ‚â•",
      "list.filter.clear": "Netejar filtre",
      "list.subtitle": "Clic al nom: +1 ‚òπÔ∏é. Botons \"+‚òπÔ∏é\" i \"+üôÇ\" per sumar sense tocar el nom.",
      "list.aria": "Llista d'alumnes",
      "empty.noStudents": "Encara no hi ha alumnes en aquesta classe. Importa una llista a dalt.",
      "sound.title": "Sem√†for de so",
      "sound.toggle.show": "Mostrar configuraci√≥",
      "sound.toggle.hide": "Amagar configuraci√≥",
      "sound.button.enable": "Activar",
      "sound.button.disable": "Desactivar",
      "sound.status.initial": "Prem ‚ÄúActivar‚Äù i permet el micr√≤fon.",
      "sound.aria.traffic": "Sem√†for de so",
      "sound.aria.readout": "Lectura del nivell de so",
      "sound.unit.level": "nivell",
      "sound.hint.green": "Verd <",
      "sound.hint.red": "¬∑ Roig ‚â•",
      "sound.calibration.aria": "Calibratge r√†pid",
      "sound.calibrate.silence": "Calibrar silenci (verd)",
      "sound.calibrate.talk": "Calibrar aula (parlant normal)",
      "sound.gain.aria": "Sensibilitat del micr√≤fon",
      "sound.gain.label": "Sensibilitat (guany)",
      "sound.range.aria": "Ajust manual del rang",
      "sound.range.green": "Verd fins (nivell 0‚Äì100)",
      "sound.range.red": "Roig des de (nivell 0‚Äì100)",
      "sound.thresholds.aria": "Llindars exactes",
      "sound.thresholds.green": "Verd fins (nivell) ‚Äî exacte",
      "sound.thresholds.red": "Roig des de (nivell) ‚Äî exacte",
      "sound.capture": "Capturar",
      "sound.colors.aria": "Colors del sem√†for",
      "sound.color.green": "Color verd",
      "sound.color.amber": "Color √†mbar",
      "sound.color.red": "Color roig",
      "sound.colors.reset": "Restablir colors",
      "mode.title": "Mode de treball",
      "mode.subtitle": "Marca l'objectiu de l'aula per a aquest moment.",
      "mode.aria.body": "Indicador del mode de treball",
      "mode.aria.badge": "Indicador del mode",
      "mode.aria.controls": "Seleccionar mode",
      "mode.label.explain": "Explicaci√≥",
      "mode.label.work": "Treball",
      "mode.label.debate": "Debat",
      "mode.hint.explain": "Objectiu: sem√†for en VERD (silenci).",
      "mode.hint.work": "Objectiu: sem√†for en √ÄMBAR (veu baixa).",
      "mode.hint.debate": "Objectiu: sem√†for en ROIG nom√©s puntualment (moderaci√≥).",
      "mode.button.explain": "Explicaci√≥ (verd)",
      "mode.button.work": "Treball (√†mbar)",
      "mode.button.debate": "Debat (roig)",
      "footer.data": "Dades desades al teu navegador (localStorage).",
      "resizer.lm": "Ajustar amplada entre Alumnes i Sem√†for",
      "resizer.mr": "Ajustar amplada entre Sem√†for i Mode",
      "status.showing": "Mostrant {visible}/{total} ({filters})",
      "status.total": "{total} alumnes",
      "empty.filter": "No hi ha alumnes que compleixin el filtre ({filters}). Baixa el filtre o suma avisos.",
      "join.and": "i",
      "aria.addOne": "Sumar +1 a {name}",
      "aria.negCount": "Avisos negatius: {count}",
      "aria.timerRemaining": "Temps restant per avisos negatius",
      "aria.posCount": "Avisos positius: {count}",
      "aria.addNeg": "Sumar av√≠s negatiu a {name}",
      "aria.addPos": "Sumar av√≠s positiu a {name}",
      "aria.viewHistory": "Veure hist√≤ric de {name}",
      "aria.editName": "Editar nom: {name}",
      "aria.deleteStudent": "Eliminar alumne: {name}",
      "status.classNameSaved": "Nom de classe desat",
      "alert.classNameEmpty": "El nom de la classe no pot estar buit.",
      "confirm.resetCounters": "Reiniciar comptadors de {className}?",
      "prompt.newName": "Nou nom per a {name}:",
      "alert.nameEmpty": "El nom no pot estar buit.",
      "alert.nameExists": "Ja existeix un alumne amb aquest nom en aquesta classe.",
      "status.nameUpdated": "Nom actualitzat",
      "confirm.deleteStudent": "Eliminar {student} de {className}?",
      "status.timerStarted": "Temporitzador iniciat",
      "status.timerPaused": "Temps en pausa",
      "status.backup.exported": "C√≤pia exportada",
      "status.backup.imported": "C√≤pia importada",
      "status.backup.selectJson": "Selecciona un .json primer",
      "confirm.backup.import": "Aix√≤ substituir√† TOTES les teves dades (totes les classes) per la c√≤pia importada. Continuar?",
      "error.backup.invalidJson": "El fitxer no √©s un JSON v√†lid",
      "error.backup.formatUnknown": "Format de c√≤pia no reconegut",
      "status.pdf.reading": "Llegint PDF‚Ä¶",
      "status.import.noNames": "No s'han detectat noms per importar",
      "status.import.done": "Importats: {added} nous ¬∑ {skipped} duplicats ¬∑ {className}",
      "error.import": "Error en importar",
      "error.export": "Error en exportar",
      "error.history": "Error en obrir l'hist√≤ric",
      "sound.status.enableFirst": "Activa el micr√≤fon primer (bot√≥ Activar).",
      "sound.status.silenceCalibrated": "Silenci calibrat: nivell {level}. Ara prem ‚ÄúCalibrar aula (parlant normal)‚Äù.",
      "sound.status.pressSilence": "Primer prem ‚ÄúCalibrar silenci (verd)‚Äù.",
      "sound.status.calibrated": "Calibrat. Verd < {green} ¬∑ Roig ‚â• {red} (nivell).",
      "sound.error.noMicSupport": "Aquest navegador no suporta acc√©s al micr√≤fon.",
      "sound.status.activating": "Activant‚Ä¶",
      "sound.status.active": "Sensor actiu. Ajusta el llindar segons necessitis.",
      "sound.error.activate": "No s'ha pogut activar el micr√≤fon",
      "sound.error.activateWithMsg": "No s'ha pogut activar: {msg}",
      "sound.status.disabled": "Sensor desactivat.",
      "sound.level.green": "VERD: el soroll est√† al llindar correcte.",
      "sound.level.amber": "√ÄMBAR: el soroll √©s acceptable, per√≤ a prop del l√≠mit.",
      "sound.level.red": "ROIG: ens hem passat amb el soroll.",
      "pdf.error.load": "No s'ha pogut carregar pdf.js: {url}",
      "pdf.error.noExpose": "pdf.js ha carregat per√≤ no ha exposat pdfjsLib",
      "pdf.error.final": "No s'ha pogut carregar pdf.js. Revisa la connexi√≥ o col¬∑loca pdf.min.js i pdf.worker.min.js a /vendor.",
      "file.error.read": "No s'ha pogut llegir el fitxer",
      "class.default": "Classe {index}"
    },
    en: {
      "app.title": "EduAvisos",
      "app.view": "View",
      "app.view.toggles": "Show or hide columns",
      "app.students": "Students",
      "app.semaphore": "Traffic light",
      "app.mode": "Mode",
      "app.class": "Class",
      "app.class.select": "Select class",
      "app.resetCounters": "Reset counters",
      "app.timer.play": "Start/Resume time",
      "app.timer.play.title": "Start",
      "app.timer.pause": "Pause time",
      "app.timer.pause.title": "Pause",
      "app.settings.open": "Open settings",
      "app.settings.title": "Settings",
      "config.title": "Settings",
      "action.close": "Close",
      "action.edit": "Edit",
      "action.delete": "Delete",
      "config.className.label": "Class name (for the selected class)",
      "config.className.placeholder": "e.g. 1A",
      "config.className.save": "Save name",
      "config.language.label": "Interface language",
      "config.language.auto": "Automatic (browser)",
      "config.language.es": "Spanish",
      "config.language.ca": "Catalan",
      "config.language.en": "English",
      "config.negMinutes": "Minutes per ‚òπÔ∏é",
      "config.posMinutes": "Minutes per üôÇ",
      "config.admin.subtitle": "Administration: export a backup of your data (all classes) or import it to restore.",
      "config.export": "Export backup (.json)",
      "config.import.label": "Import backup (.json)",
      "config.import.button": "Import backup",
      "config.importStudents.subtitle": "Import students: paste a list (one per line) or upload a .txt/.csv file. They are ADDED to the current class (nothing is deleted).",
      "config.importPaste.label": "Paste list",
      "config.importPaste.placeholder": "Example:\nAna P√©rez\nJuan L√≥pez\nMar√≠a Garc√≠a",
      "config.importFile.label": "File",
      "config.importPdf.label": "PDF (verReport)",
      "config.import.apply": "Import into this class",
      "config.import.clear": "Clear box",
      "timer.title": "Pending time (‚òπÔ∏é)",
      "timer.subtitle": "Students with pending time in the current class. The countdown updates live while the timer is playing.",
      "timer.empty": "No students with pending time in this class.",
      "timer.list.aria": "Students with pending time",
      "history.title": "History",
      "history.list.aria": "Student history",
      "history.empty": "This student has no history events yet.",
      "classHistory.title": "Class history",
      "classHistory.subtitle": "Per-student summary (totals of ‚òπÔ∏é and üôÇ).",
      "classHistory.list.aria": "Class summary",
      "classHistory.empty": "This class has no points in history yet.",
      "list.title": "Students",
      "list.classHistory": "Class history",
      "list.filter.neg": "‚òπÔ∏é ‚â•",
      "list.filter.pos": "üôÇ ‚â•",
      "list.filter.clear": "Clear filter",
      "list.subtitle": "Click the name: +1 ‚òπÔ∏é. Use \"+‚òπÔ∏é\" and \"+üôÇ\" to add without clicking the name.",
      "list.aria": "Student list",
      "empty.noStudents": "There are no students in this class yet. Import a list above.",
      "sound.title": "Sound traffic light",
      "sound.toggle.show": "Show settings",
      "sound.toggle.hide": "Hide settings",
      "sound.button.enable": "Enable",
      "sound.button.disable": "Disable",
      "sound.status.initial": "Press ‚ÄúEnable‚Äù and allow the microphone.",
      "sound.aria.traffic": "Sound traffic light",
      "sound.aria.readout": "Sound level readout",
      "sound.unit.level": "level",
      "sound.hint.green": "Green <",
      "sound.hint.red": "¬∑ Red ‚â•",
      "sound.calibration.aria": "Quick calibration",
      "sound.calibrate.silence": "Calibrate silence (green)",
      "sound.calibrate.talk": "Calibrate classroom (normal speech)",
      "sound.gain.aria": "Microphone sensitivity",
      "sound.gain.label": "Sensitivity (gain)",
      "sound.range.aria": "Manual range adjustment",
      "sound.range.green": "Green up to (level 0‚Äì100)",
      "sound.range.red": "Red from (level 0‚Äì100)",
      "sound.thresholds.aria": "Exact thresholds",
      "sound.thresholds.green": "Green up to (level) ‚Äî exact",
      "sound.thresholds.red": "Red from (level) ‚Äî exact",
      "sound.capture": "Capture",
      "sound.colors.aria": "Traffic light colors",
      "sound.color.green": "Green color",
      "sound.color.amber": "Amber color",
      "sound.color.red": "Red color",
      "sound.colors.reset": "Reset colors",
      "mode.title": "Work mode",
      "mode.subtitle": "Set the classroom goal for this moment.",
      "mode.aria.body": "Work mode indicator",
      "mode.aria.badge": "Mode indicator",
      "mode.aria.controls": "Select mode",
      "mode.label.explain": "Explanation",
      "mode.label.work": "Work",
      "mode.label.debate": "Debate",
      "mode.hint.explain": "Goal: traffic light in GREEN (silence).",
      "mode.hint.work": "Goal: traffic light in AMBER (low voice).",
      "mode.hint.debate": "Goal: traffic light in RED only briefly (moderation).",
      "mode.button.explain": "Explanation (green)",
      "mode.button.work": "Work (amber)",
      "mode.button.debate": "Debate (red)",
      "footer.data": "Data saved in your browser (localStorage).",
      "resizer.lm": "Resize width between Students and Traffic light",
      "resizer.mr": "Resize width between Traffic light and Mode",
      "status.showing": "Showing {visible}/{total} ({filters})",
      "status.total": "{total} students",
      "empty.filter": "No students match the filter ({filters}). Lower the filter or add notices.",
      "join.and": "and",
      "aria.addOne": "Add +1 to {name}",
      "aria.negCount": "Negative notices: {count}",
      "aria.timerRemaining": "Time remaining for negative notices",
      "aria.posCount": "Positive notices: {count}",
      "aria.addNeg": "Add negative notice to {name}",
      "aria.addPos": "Add positive notice to {name}",
      "aria.viewHistory": "View history for {name}",
      "aria.editName": "Edit name: {name}",
      "aria.deleteStudent": "Delete student: {name}",
      "status.classNameSaved": "Class name saved",
      "alert.classNameEmpty": "Class name cannot be empty.",
      "confirm.resetCounters": "Reset counters for {className}?",
      "prompt.newName": "New name for {name}:",
      "alert.nameEmpty": "Name cannot be empty.",
      "alert.nameExists": "A student with that name already exists in this class.",
      "status.nameUpdated": "Name updated",
      "confirm.deleteStudent": "Delete {student} from {className}?",
      "status.timerStarted": "Timer started",
      "status.timerPaused": "Time paused",
      "status.backup.exported": "Backup exported",
      "status.backup.imported": "Backup imported",
      "status.backup.selectJson": "Select a .json file first",
      "confirm.backup.import": "This will replace ALL your data (all classes) with the imported backup. Continue?",
      "error.backup.invalidJson": "The file is not valid JSON",
      "error.backup.formatUnknown": "Backup format not recognized",
      "status.pdf.reading": "Reading PDF‚Ä¶",
      "status.import.noNames": "No names were detected for import",
      "status.import.done": "Imported: {added} new ¬∑ {skipped} duplicates ¬∑ {className}",
      "error.import": "Import error",
      "error.export": "Export error",
      "error.history": "Error opening history",
      "sound.status.enableFirst": "Enable the microphone first (Enable button).",
      "sound.status.silenceCalibrated": "Silence calibrated: level {level}. Now press ‚ÄúCalibrate classroom (normal speech)‚Äù.",
      "sound.status.pressSilence": "Press ‚ÄúCalibrate silence (green)‚Äù first.",
      "sound.status.calibrated": "Calibrated. Green < {green} ¬∑ Red ‚â• {red} (level).",
      "sound.error.noMicSupport": "This browser does not support microphone access.",
      "sound.status.activating": "Enabling‚Ä¶",
      "sound.status.active": "Sensor active. Adjust the threshold as needed.",
      "sound.error.activate": "Could not enable microphone",
      "sound.error.activateWithMsg": "Could not enable: {msg}",
      "sound.status.disabled": "Sensor disabled.",
      "sound.level.green": "GREEN: noise is within the correct threshold.",
      "sound.level.amber": "AMBER: noise is acceptable, but near the limit.",
      "sound.level.red": "RED: noise level is too high.",
      "pdf.error.load": "Could not load pdf.js: {url}",
      "pdf.error.noExpose": "pdf.js loaded but did not expose pdfjsLib",
      "pdf.error.final": "Could not load pdf.js. Check the connection or place pdf.min.js and pdf.worker.min.js in /vendor.",
      "file.error.read": "Could not read the file",
      "class.default": "Class {index}"
    }
  };

  function normalizeLanguage(code) {
    if (!code) return null;
    const lc = code.toLowerCase();
    if (lc.startsWith("ca")) return "ca";
    if (lc.startsWith("en")) return "en";
    if (lc.startsWith("es")) return "es";
    return null;
  }

  function detectLanguage() {
    const langs = Array.isArray(navigator.languages) ? navigator.languages : [navigator.language];
    for (const lang of langs) {
      const normalized = normalizeLanguage(lang);
      if (normalized) return normalized;
    }
    return DEFAULT_LANGUAGE;
  }

  let preferenceGetter = () => "auto";

  function setLanguagePreferenceGetter(fn) {
    if (typeof fn === "function") preferenceGetter = fn;
  }

  function getResolvedLanguage() {
    const pref = preferenceGetter();
    if (!pref || pref === "auto") return detectLanguage();
    return SUPPORTED_LANGUAGES.includes(pref) ? pref : DEFAULT_LANGUAGE;
  }

  function t(key, vars) {
    const lang = getResolvedLanguage();
    const base = I18N[lang] || I18N[DEFAULT_LANGUAGE] || {};
    const fallback = I18N[DEFAULT_LANGUAGE] || {};
    let text = base[key] ?? fallback[key] ?? key;
    if (vars && typeof vars === "object") {
      for (const [k, v] of Object.entries(vars)) {
        text = text.replace(new RegExp(`\\{${k}\\}`, "g"), String(v));
      }
    }
    return text;
  }

  window.EduI18n = {
    DEFAULT_LANGUAGE,
    SUPPORTED_LANGUAGES,
    I18N,
    normalizeLanguage,
    detectLanguage,
    setLanguagePreferenceGetter,
    getResolvedLanguage,
    t,
  };
})();
