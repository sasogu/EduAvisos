<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>EduAvisos</title>

    <!-- Anti-cach√© (√∫til en desarrollo con http.server / recargas) -->
    <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />

    <script>
      // Cache-busting autom√°tico: fuerza recarga de CSS/JS en cada carga.
      (function () {
        const v = Date.now().toString();
        window.__EDUNOTAS_V = v;

        const link = document.createElement("link");
        link.rel = "stylesheet";
        link.href = `styles.css?v=${v}`;
        document.head.appendChild(link);
      })();
    </script>
  </head>
  <body>
    <header class="header">
      <div class="container header__row">
        <h1 class="title">EduAvisos</h1>
        <div class="controls">
          <div class="viewToggles" aria-label="Vista">
            <span class="field__label">Vista</span>
            <div class="viewToggles__buttons" role="group" aria-label="Mostrar u ocultar columnas">
              <button id="toggleLeftColBtn" class="btn btn--secondary" type="button" aria-pressed="true">Alumnos</button>
              <button id="toggleMidColBtn" class="btn btn--secondary" type="button" aria-pressed="true">Sem√°foro</button>
              <button id="toggleRightColBtn" class="btn btn--secondary" type="button" aria-pressed="true">Modo</button>
            </div>
          </div>

          <label class="field">
            <span class="field__label">Clase</span>
            <select id="classSelect" class="field__input" aria-label="Seleccionar clase"></select>
          </label>

          <button id="resetClassBtn" class="btn btn--secondary" type="button">Reiniciar contadores</button>

          <button id="timerPlayBtn" class="btn btn--secondary iconBtn" type="button" aria-label="Iniciar/Reanudar tiempo" title="Play">‚ñ∂Ô∏é</button>
          <button id="timerPauseBtn" class="btn btn--secondary iconBtn" type="button" aria-label="Pausar tiempo" title="Pausa">‚è∏</button>

          <button id="openImportBtn" class="btn iconBtn" type="button" aria-label="Abrir configuraci√≥n" title="Configuraci√≥n">‚öôÔ∏é</button>
        </div>
      </div>
    </header>

    <main class="container container--fluid">
      <div id="splitLayout" class="split">
        <div class="split__left">
      <dialog id="importDialog" class="modal" aria-labelledby="importDialogTitle">
        <div class="modal__header">
          <h3 id="importDialogTitle" class="modal__title">Configuraci√≥n</h3>
          <button id="closeImportBtn" class="btn btn--secondary" type="button">Cerrar</button>
        </div>

        <div class="config">
          <div class="config__row">
            <label class="field field--grow">
              <span class="field__label">Nombre de clase (para la clase seleccionada)</span>
              <input id="className" class="field__input" type="text" placeholder="Ej: 1¬∫A" />
            </label>
            <button id="saveClassNameBtn" class="btn" type="button">Guardar nombre</button>
          </div>

          <div class="config__row">
            <label class="field">
              <span class="field__label">Minutos por ‚òπÔ∏é</span>
              <input id="negMinutesPerPoint" class="field__input field__input--small" type="number" min="0" step="1" value="5" />
            </label>
            <label class="field">
              <span class="field__label">Minutos por üôÇ</span>
              <input id="posMinutesPerPoint" class="field__input field__input--small" type="number" min="0" step="1" value="5" />
            </label>
          </div>
        </div>

        <p class="modal__subtitle">Administraci√≥n: exporta una copia de seguridad de tus datos (todas las clases) o imp√≥rtala para restaurar.</p>

        <div class="config">
          <div class="config__row">
            <button id="exportBackupBtn" class="btn" type="button">Exportar copia (.json)</button>

            <label class="field">
              <span class="field__label">Importar copia (.json)</span>
              <input id="importBackupFile" class="field__input" type="file" accept="application/json,.json" />
            </label>

            <button id="importBackupBtn" class="btn btn--secondary" type="button">Importar copia</button>
          </div>
        </div>

        <p class="modal__subtitle">Importa alumnos: pega una lista (1 por l√≠nea) o carga un archivo .txt/.csv. Se A√ëADEN a la clase actual (no se borra lo existente).</p>

        <div class="import">
          <label class="field field--grow">
            <span class="field__label">Pegar lista</span>
            <textarea id="importTextarea" class="field__input field__textarea" rows="8" placeholder="Ejemplo:
Ana P√©rez
Juan L√≥pez
Mar√≠a Garc√≠a"></textarea>
          </label>

          <div class="import__actions">
            <label class="field">
              <span class="field__label">Archivo</span>
              <input id="importFile" class="field__input" type="file" accept=".txt,.csv,text/plain,text/csv" />
            </label>

            <label class="field">
              <span class="field__label">PDF (verReport)</span>
              <input id="importPdf" class="field__input" type="file" accept="application/pdf,.pdf" />
            </label>

            <button id="importApplyBtn" class="btn" type="button">Importar en esta clase</button>
            <button id="importClearBtn" class="btn btn--secondary" type="button">Limpiar caja</button>
          </div>
        </div>
      </dialog>

      <dialog id="timerDialog" class="modal" aria-labelledby="timerDialogTitle">
        <div class="modal__header">
          <h3 id="timerDialogTitle" class="modal__title">Tiempo pendiente (‚òπÔ∏é)</h3>
          <button id="closeTimerBtn" class="btn btn--secondary" type="button">Cerrar</button>
        </div>

        <p class="modal__subtitle">Alumnos con tiempo pendiente en la clase actual. La cuenta atr√°s se actualiza en vivo mientras el temporizador est√° en Play.</p>

        <ul id="timerStudentList" class="list" aria-label="Alumnos con tiempo pendiente"></ul>
        <div id="timerEmpty" class="empty" hidden>No hay alumnos con tiempo pendiente en esta clase.</div>
      </dialog>

      <dialog id="historyDialog" class="modal" aria-labelledby="historyDialogTitle">
        <div class="modal__header">
          <h3 id="historyDialogTitle" class="modal__title">Hist√≥rico</h3>
          <button id="closeHistoryBtn" class="btn btn--secondary" type="button">Cerrar</button>
        </div>

        <p id="historySubtitle" class="modal__subtitle"></p>

        <ul id="historyList" class="list" aria-label="Hist√≥rico del alumno"></ul>
        <div id="historyEmpty" class="empty" hidden>Este alumno a√∫n no tiene eventos en el hist√≥rico.</div>
      </dialog>

      <dialog id="classHistoryDialog" class="modal" aria-labelledby="classHistoryDialogTitle">
        <div class="modal__header">
          <h3 id="classHistoryDialogTitle" class="modal__title">Hist√≥rico de la clase</h3>
          <button id="closeClassHistoryBtn" class="btn btn--secondary" type="button">Cerrar</button>
        </div>

        <p id="classHistorySubtitle" class="modal__subtitle">Resumen por alumno (totales de ‚òπÔ∏é y üôÇ).</p>

        <ul id="classHistoryList" class="list" aria-label="Resumen de la clase"></ul>
        <div id="classHistoryEmpty" class="empty" hidden>Esta clase a√∫n no tiene puntos en el hist√≥rico.</div>
      </dialog>

      <section class="panel" aria-labelledby="listTitle">
        <div class="panel__header">
          <div class="panel__headerRow">
            <h2 id="listTitle" class="panel__title">Alumnos</h2>
            <button id="openClassHistoryBtn" class="btn btn--secondary" type="button">Hist√≥rico de la clase</button>
            <div class="listControls">
              <label class="field field--inline">
                <span class="field__label">‚òπÔ∏é ‚â•</span>
                <input id="minCount" class="field__input field__input--small" type="number" min="0" step="1" value="0" />
              </label>
              <label class="field field--inline">
                <span class="field__label">üôÇ ‚â•</span>
                <input id="minPositive" class="field__input field__input--small" type="number" min="0" step="1" value="0" />
              </label>
              <button id="clearFilterBtn" class="btn btn--secondary" type="button">Limpiar filtro</button>
              <div class="status" id="status"></div>
            </div>
          </div>
          <p class="panel__subtitle">Click en el nombre: +1 ‚òπÔ∏é. Botones "+‚òπÔ∏é" y "+üôÇ" para sumar sin pinchar el nombre.</p>
        </div>

        <div id="emptyState" class="empty" hidden>
          A√∫n no hay alumnos en esta clase. Importa una lista arriba.
        </div>

        <ul id="studentList" class="list" aria-label="Lista de alumnos"></ul>
      </section>

        </div>

        <div class="split__resizer" data-resizer="lm" role="separator" aria-orientation="vertical" tabindex="0" aria-label="Ajustar ancho entre Alumnos y Sem√°foro"></div>

        <aside class="split__mid">
          <section id="soundPanel" class="panel soundPanel" aria-labelledby="soundTitle">
            <div class="panel__header">
              <div class="panel__headerRow">
                <h2 id="soundTitle" class="panel__title">Sem√°foro de sonido</h2>
                <div class="soundHeaderBtns">
                  <button id="soundToggleConfigBtn" class="btn btn--secondary" type="button">Ocultar configuraci√≥n</button>
                  <button id="soundEnableBtn" class="btn btn--secondary" type="button">Activar</button>
                </div>
              </div>
              <p id="soundStatusText" class="panel__subtitle" aria-live="polite">Pulsa ‚ÄúActivar‚Äù y permite el micr√≥fono.</p>
            </div>

            <div class="soundBody">
              <div class="trafficLight" role="img" aria-label="Sem√°foro de sonido">
                <div class="light light--red" data-light="red"></div>
                <div class="light light--amber" data-light="amber"></div>
                <div class="light light--green" data-light="green"></div>
              </div>

              <div class="soundReadout" aria-label="Lectura del nivel de sonido">
                <div class="soundValue"><span id="soundDb">‚Äî</span> <span class="soundUnit">nivel</span></div>
                <div class="soundHint">
                  Verde &lt; <span id="soundGreenTh">‚Äî</span> ¬∑ Rojo ‚â• <span id="soundRedTh">‚Äî</span>
                </div>
              </div>
            </div>

            <div class="soundCalibrate" aria-label="Calibraci√≥n r√°pida">
              <button id="soundCalibrateSilenceBtn" class="btn btn--secondary" type="button">Calibrar silencio (verde)</button>
              <button id="soundCalibrateTalkBtn" class="btn btn" type="button">Calibrar aula (hablando normal)</button>
            </div>

            <div class="soundGain" aria-label="Sensibilidad del micr√≥fono">
              <label class="field field--grow">
                <span class="field__label">Sensibilidad (ganancia)</span>
                <input id="soundGainSlider" class="field__input" type="range" min="0.25" max="4" step="0.05" value="1" />
                <span class="sliderValue" aria-live="polite">x<span id="soundGainValue">1.00</span></span>
              </label>
            </div>

            <div class="soundSliders" aria-label="Ajuste manual del rango">
              <label class="field">
                <span class="field__label">Verde hasta (nivel 0‚Äì100)</span>
                <input id="soundGreenSlider" class="field__input" type="range" min="0" max="100" step="1" value="80" />
                <span class="sliderValue" aria-live="polite"><span id="soundGreenSliderValue">80</span></span>
              </label>

              <label class="field">
                <span class="field__label">Rojo desde (nivel 0‚Äì100)</span>
                <input id="soundRedSlider" class="field__input" type="range" min="0" max="100" step="1" value="90" />
                <span class="sliderValue" aria-live="polite"><span id="soundRedSliderValue">90</span></span>
              </label>
            </div>

            <div class="soundThresholds" aria-label="Umbrales exactos">
              <label class="field">
                <span class="field__label">Verde hasta (nivel) ‚Äî exacto</span>
                <div class="thresholdRow">
                  <input id="soundGreenNumber" class="field__input" type="number" min="0" max="100" step="1" value="80" />
                  <button id="soundCaptureGreenBtn" class="btn btn--secondary" type="button">Capturar</button>
                </div>
              </label>

              <label class="field">
                <span class="field__label">Rojo desde (nivel) ‚Äî exacto</span>
                <div class="thresholdRow">
                  <input id="soundRedNumber" class="field__input" type="number" min="0" max="100" step="1" value="90" />
                  <button id="soundCaptureRedBtn" class="btn btn--secondary" type="button">Capturar</button>
                </div>
              </label>
            </div>

            <div class="soundColors" aria-label="Colores del sem√°foro">
              <label class="field">
                <span class="field__label">Color verde</span>
                <input id="soundGreenColor" class="field__input" type="color" value="#00d26a" />
              </label>

              <label class="field">
                <span class="field__label">Color √°mbar</span>
                <input id="soundAmberColor" class="field__input" type="color" value="#ffb000" />
              </label>

              <label class="field">
                <span class="field__label">Color rojo</span>
                <input id="soundRedColor" class="field__input" type="color" value="#ff3b3b" />
              </label>

              <button id="soundResetColorsBtn" class="btn btn--secondary" type="button">Restablecer colores</button>
            </div>
          </section>
        </aside>

        <div class="split__resizer" data-resizer="mr" role="separator" aria-orientation="vertical" tabindex="0" aria-label="Ajustar ancho entre Sem√°foro y Modo"></div>

        <aside class="split__right">
          <section id="modePanel" class="panel modePanel" aria-labelledby="modeTitle">
            <div class="panel__header">
              <div class="panel__headerRow">
                <h2 id="modeTitle" class="panel__title">Modo de trabajo</h2>
              </div>
              <p class="panel__subtitle">Marca el objetivo del aula para este momento.</p>
            </div>

            <div class="modeBody" aria-label="Indicador del modo de trabajo">
              <div id="modeBadge" class="modeBadge" role="img" aria-label="Indicador del modo">
                <div id="modeEmoji" class="modeEmoji">ü§´</div>
                <div class="modeText">
                  <div id="modeLabel" class="modeLabel">Explicaci√≥n</div>
                  <div id="modeHint" class="modeHint">Objetivo: sem√°foro en VERDE (silencio).</div>
                </div>
              </div>
            </div>

            <div class="modeControls" aria-label="Seleccionar modo">
              <button id="modeExplainBtn" class="btn" type="button">Explicaci√≥n (verde)</button>
              <button id="modeWorkBtn" class="btn btn--secondary" type="button">Trabajo (√°mbar)</button>
              <button id="modeDebateBtn" class="btn btn--secondary" type="button">Debate (rojo)</button>
            </div>
          </section>
        </aside>
      </div>
    </main>

    <footer class="footer">
      <div class="container footer__row">
        <span class="muted">Datos guardados en tu navegador (localStorage).</span>
      </div>
    </footer>

    <script>
      (function () {
        const v = window.__EDUNOTAS_V || Date.now().toString();
        const s = document.createElement("script");
        s.src = `app.js?v=${v}`;
        document.body.appendChild(s);
      })();
    </script>
  </body>
</html>
